---
author: Xuanwo <github@xuanwo.io>
status: 完成
updated_at: 2020-01-13
---

# 建议：规范元数据存储类

## 二. 背景

> 关于 `存储类的简单介绍`
> 
> 存储服务通常为不同的使用情况提供不同的存储类。 - 对于经常访问的热数据来说，服务可以优化低延迟和高通量性能。 - 对于多年来访问过一两次的冷数据来说，服务能够优化耐久性和低成本。
> 
> 服务将在对象元数据中标记不同的存储类别。

如提议 [6－规范化元数据](https://github.com/Xuanwo/storage/blob/master/docs/design/6-normalize-metadata.md)所述，存储类是一个尚未标准化的元数据。 我们需要使它正常化，以便我们能够在不同的服务中使用它们。

我们有以下问题要解决：

### 不同的名称

不同的服务名称可能不同。

作为私人元数据，服务部门可以将它们分配给私人头部：

- `qingstor` 使用 `x-qs-storage-class` 携带 `storage-class`
- `s3` 使用 `x-amz-storage-class` 携带 `storage-class`

即使存储等级本身也不是常见的用法：

- `zblob` 使用 `AccessTier` 表示不同的存储类

### 不同的值

它明显不同的提供者不会使用相同的含义。

- `s3` 使用 `Standard`, `Standard-IA`, `Intelligent-Tiering`, `冰川` 等等。
- `zblob` 使用 `热门`, `酷` 和 `归档`.
- `gcs` 使用 `Standard`, `附近` 和 `Coldline`.
- ...

几乎每个提供者都有自己的存储类别值。

### 不同的TTFB

> TTFB：第一个字节的时间

不同的存储等级在图层存储介质或提供不同的TTFB授权证的算法下是不同的。

- `s3`: `Standard` TTFB might be 毫秒，而 `冰川` 需要 `选择分钟或小时`
- `gcs`: 所有存储类都提供相同的延迟时间
- `kodo`: `存档` 需要另一个 API 来还原文件
- `cos`: `Archvie` 需要提交应用程序以恢复文件
- ...

我们需要克服这些分歧。

## 建议

因此，我提议作如下修改：

### 正常化名称

`存储类`的元数据 </code> 的名称将正常化为 `存储类`。

### 添加全局存储类集

添加 `Hot`, `Warm`, `冷` 存储类作为跨存储服务集合的全局存储类。

`热门` 用于经常访问的数据。

 - 所有服务支持这种存储类
 - 所有服务的默认存储类
 - 如果某项服务对存储类没有任何想法，它将提供 `热` 存储类

`暖` 用于不经常访问的数据，也许每月访问数次。

 - 与 `热点相比，延迟率更高，性能更低`
 - `读取` 操作需要额外费用 (取决于服务)

`冷` 用于存档可能每年访问一两次的数据。

- `冷` 只支持写入操作
- 取决于服务的实现, `冷`, a.k. , `存档` 存储类可能需要额外的时间 (分钟到小时) 除了 `gcs`或额外的 API (`kodo`) 甚至手动应用程序(`cos`). 所以我们不会为阅读 `冷` 数据添加额外支持，只需返回错误。

最后：

- `热门` 将被映射到服务的最快/默认存储类
- `温暖` 将是服务中不常见的访问存储类
- `冷` 将是用于服务的归档存储类

例如：

- s3 `标准` == `热点`
- s3 `标准` == `暖`
- s3 `冰川` == `寒冷`

### 服务行为速度

- 从配对读取存储类，服务需要从全局存储类解析
- 将存储类写入元数据，服务需要格式化成全局存储类
- 从全局存储类解析时遇到不支持的存储类， 返回 `错误StorageClassNotsupported` 服务名称和存储类名称不止一个存储类
- 在格式化为全局存储类时满足不支持的存储类，返回 `错误存储类支持` 服务名称和存储类名称

## 理由

### 服务存储类

#### azblob

ref: https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-storage-tiers

- 热: 优化存储经常访问的数据。
- 冷却：优化储存不经常存取和储存至少30天的数据。
- 存档：优化储存很少存取和储存至少180天、灵活延迟要求（按小时排列）的数据。

#### 牛座

ref: https://cloud.tencent.com/document/product/436/33417

- 标准：COS 标准是一种可靠性、可用性和性能高的对象存储服务。其延迟率低和通过率高使得它很适合使用大量热点文件或经常数据存取的情况。
- Standard_IA：COS 不经常访问 (COS Standard_IA) 提供物体储存服务，其特点是可靠性高，储存成本低，存取延迟。 它提供了降低的存储定价，并将第一字节访问时间保持在毫秒内，确保数据能够在无需等待的情况下快速检索。 但是，数据检索要费用。 它适合于存取频率较低的业务情景(例如每月一次或两次)。
- 存档：存档存储是一个非常可靠的物体存储服务，具有超低的存储成本和长期数据保留。 描述最低的存储价格， 存档存储需要更长时间才能读取数据，并适合于存档的需要长期储存的数据。

#### 投放箱

无

#### fs

无

#### gcs

ref: https://cloud.google.com/storage/docs/storage-class

- 标准：标准存储最适合于经常访问的数据(“热”数据)和/或只储存短暂时间。
- 近线：近线存储是一种低成本、高度耐用的存储服务，用于存储不经常访问的数据。 在可用性稍低的情况下，近线存储比标准存储更好的选择。 a 30天最低储存期限和数据存取费用是可接受的减让，可用于减低休息时间储存费用。
- Coldline：Coldline Storage 是一种非常低成本、高度耐久的存储服务，用于存储不经常访问的数据。 在可用性稍低的情况下，Coldline Storage 是比标准存储或近线存储更好的选择。 最低90天储存期限和更高的数据存取费用是减低休息时间储存费用的可以接受的折衷办法。
- 档案：档案储存是用于数据存档、在线备份和灾后恢复的成本最低、高度持久的储存服务。 不同于其他云端提供商提供的“coldest”存储服务，您的数据可以在毫秒内提供，而不是在小时或天内。

#### kodo

ref: https://developer.qiniu.com/kodo/api/3710/chtype

- STANDARD (0, 标准存储)
- STANDARD_IA (1，每秒)
- ARCHIVE (2，每秒)

#### oss

ref： https://www.alibabacloud.com/help/doc-detail/51374.htm

- 标准：开放源码软件标准存储提供了高度可靠、高度可用和高性能的目标存储服务，支持经常获取数据。 开放源码软件的高通量和低延迟服务反应能力能够有效地支持获取热数据。 标准存储是存储用于社交网络和分享的图像的理想方式。 并储存用于视听应用、大型网站和大型数据分析的数据。
- IA：开放源码软件IA 储存适合于储存寿命长但较少使用的数据(平均每月一次或两次)。 IA 存储设备价格低于标准存储设备。 适合于长期备份各种移动应用、智能设备数据和企业数据。 它还支持实时数据访问。 IA级存储对象具有最小存储时间。
- 存档：开放源码软件存档存储在三个储存类别中价格最低。 它适合长期（至少半年）储存不经常查阅的数据。 数据可能需要约一分钟才能恢复，然后才能读取。 这种储存办法适合于诸如档案数据、医疗图像、科学材料和录像带等数据。

#### qingstor

ref: https://www.qingcloud.com/products/qingstor/

- 标准的
- 标准IA

#### s3

ref: https://docs.aws.amazon.com/AmazonS3/latest/dev/storage-class-intro.html

- STANDARD：经常访问的数据
- STANDARD_IA：长寿、不经常访问的数据
- INTELIGENT_TIERING: 带有变化或未知访问模式的长寿数据
- ONEZONE_IA：寿命长、存取频率、非关键数据
- GLACIER：长期数据存档，检索时间从分钟到小时不等。
- DEEP_ARCHIVE：存档数据很少，默认检索时间为12小时

#### uss

不是 GA

### 为什么 `Hot`, `暖` 和 `寒冷`？

服务提供商总是将其产品包装成精美的名称，我们需要找出核心值。 我不想回答 `为什么`, 我喜欢 `为什么不`。

#### 为什么没有 `标准`？

是的， `标准` 都被广泛使用，6/7服务选择 `标准` 为他们的默认存储等级。

然而，我不知道什么 `标准` 作为一个没有任何存储类信息的新手，我怎么能认识到 `Standard` 在 10 秒内被经常访问的数据？ 什么是 `标准`？ 是否有 -`标准`？

从我的角度来看，其他人只是因为 `S3` 挑选了这个名字。 它是 `亚马逊网络服务的 <code>标准`</code>。

#### 为什么不在 `附近`？

`附近` 历史悠久，可追溯到 [IBM 3850 质量存储系统磁带库1974年](https://en.wikipedia.org/wiki/Nearline_storage) 对2020年的开发者来说，除了那些以存储为重点的人外，他们对这个想法的了解越来越少。

作为一个面向应用程序的统一存储层，让用户选择他们的数据类型而不是存储类型更加合理。

最后：

`热门`, `暖` 和 `寒冷` 是清楚的，没有混淆的，可以理解。

不用说，它们要短得多：-)

## 兼容性

所有带有存储类的 API 调用将受到影响。

## 二． 执行情况

大多数工作将由本提案的作者完成。
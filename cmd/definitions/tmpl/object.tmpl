// Code generated by go generate internal/cmd; DO NOT EDIT.
package types

import (
    "fmt"
    "time"
    "sync"
)

type Object struct {
{{- range $k, $v := .ObjectMeta }}
    {{- if $v.Comment }}
     // {{ $v.Comment }}
    {{- end }}
    {{ $v.TypeName }} {{ $v.Type }}
{{- end }}

	// client is the client in which Object is alive.
	client Storager
	// m stores storage related metadata.
    meta map[string]interface{}

    // bit used as a bitmap for object value, 0 means not set, 1 means set
    bit uint64
	done uint32
	m    sync.Mutex
}


{{- range $k, $v := .ObjectMeta }}
{{- if $v.Export }}
func (o *Object) Get{{ $v.DisplayName }}() {{ $v.Type }} {
    return o.{{ $v.TypeName }}
}

func (o *Object) Set{{ $v.DisplayName }}(v {{ $v.Type }}) *Object {
    o.{{ $v.TypeName }} = v
    return o
}
{{- else }}

func (o *Object) Get{{ $v.DisplayName }}() ({{ $v.Type }}, bool) {
    o.stat()

    if o.bit & (1<<{{ $k }}) == 1 {
        return o.{{ $v.TypeName }}, true
    }

    {{- if $v.ZeroValue }}
        return {{ $v.ZeroValue }}, false
    {{- else }}
        return {{ $v.Type | zeroValue }}, false
    {{- end }}
}

func (o *Object) MustGet{{ $v.DisplayName }}() {{ $v.Type }} {
    o.stat()

    if o.bit & (1<<{{ $k }}) != 1 {
        panic(fmt.Sprintf("object {{ $v.Name }} is not set"))
    }
    return o.{{ $v.TypeName }}
}

func (o *Object) Set{{ $v.DisplayName }}(v {{ $v.Type }}) *Object {
    o.{{ $v.TypeName }} = v
    o.bit |= 1<<{{ $k }}
    return o
}
{{- end }}
{{- end }}

func (o *Object) clone(xo *Object) {
    {{- range $k, $v := .ObjectMeta }}
    o.{{ $v.TypeName }} = xo.{{ $v.TypeName }}
    {{- end }}

    o.meta = xo.meta

    o.bit = xo.bit
}